<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Zot Registry"><link href=https://zotregistry.dev/v2.1.9/articles/workflow/ rel=canonical><link href=../immutable-tags/ rel=prev><link href=../security-posture/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.32"><title>Software Provenance Workflow Using OCI Artifacts - zotregistry.dev</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#software-provenance-workflow-using-oci-artifacts class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://zotregistry.dev title=zotregistry.dev class="md-header__button md-logo" aria-label=zotregistry.dev data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> zotregistry.dev </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Software Provenance Workflow Using OCI Artifacts </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/project-zot/zot title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> project-zot/zot </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://zotregistry.dev title=zotregistry.dev class="md-nav__button md-logo" aria-label=zotregistry.dev data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> zotregistry.dev </label> <div class=md-nav__source> <a href=https://github.com/project-zot/zot title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> project-zot/zot </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../general/whats-new/ class=md-nav__link> <span class=md-ellipsis> What's New </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> General </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> General </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../general/concepts/ class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../general/features/ class=md-nav__link> <span class=md-ellipsis> Key Features </span> </a> </li> <li class=md-nav__item> <a href=../../general/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../general/extensions/ class=md-nav__link> <span class=md-ellipsis> Extensions </span> </a> </li> <li class=md-nav__item> <a href=../../general/releases/ class=md-nav__link> <span class=md-ellipsis> Released Images </span> </a> </li> <li class=md-nav__item> <a href=../../general/glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../general/project/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> User Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guides/user-guide-datapath/ class=md-nav__link> <span class=md-ellipsis> Push and Pull Image Content </span> </a> </li> <li class=md-nav__item> <a href=../../user-guides/user-guide-gui/ class=md-nav__link> <span class=md-ellipsis> Use the Web Interface to Find Images </span> </a> </li> <li class=md-nav__item> <a href=../../user-guides/zli/ class=md-nav__link> <span class=md-ellipsis> Command Line (zli) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Installation Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Installation Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install-guides/install-guide-linux/ class=md-nav__link> <span class=md-ellipsis> Installing zot on Bare Metal Linux </span> </a> </li> <li class=md-nav__item> <a href=../../install-guides/install-guide-k8s/ class=md-nav__link> <span class=md-ellipsis> Installing zot with Kubernetes and Helm </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Administrator Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Administrator Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin-guide/admin-getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../admin-guide/admin-configuration/ class=md-nav__link> <span class=md-ellipsis> Configuring zot </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/onboarding/ class=md-nav__link> <span class=md-ellipsis> Onboarding </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/extensions-dev/ class=md-nav__link> <span class=md-ellipsis> Extensions </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/api-user-guide/ class=md-nav__link> <span class=md-ellipsis> Using the API </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Articles </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Articles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../building-ci-cd-pipeline/ class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../authn-authz/ class=md-nav__link> <span class=md-ellipsis> Authentication and Authorization </span> </a> </li> <li class=md-nav__item> <a href=../verifying-signatures/ class=md-nav__link> <span class=md-ellipsis> Verifying Image Signatures </span> </a> </li> <li class=md-nav__item> <a href=../immutable-tags/ class=md-nav__link> <span class=md-ellipsis> Immutable Tags </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Software Provenance Workflow Using OCI Artifacts </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Software Provenance Workflow Using OCI Artifacts </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#workflow class=md-nav__link> <span class=md-ellipsis> Workflow </span> </a> <nav class=md-nav aria-label=Workflow> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-download-the-client-tools class=md-nav__link> <span class=md-ellipsis> Step 1: Download the client tools </span> </a> </li> <li class=md-nav__item> <a href=#step-2-deploy-an-oci-registry-with-referrers-support-zot class=md-nav__link> <span class=md-ellipsis> Step 2: Deploy an OCI registry with referrers support (zot) </span> </a> </li> <li class=md-nav__item> <a href=#step-3-copy-an-image-to-the-oci-registry class=md-nav__link> <span class=md-ellipsis> Step 3: Copy an image to the OCI registry </span> </a> </li> <li class=md-nav__item> <a href=#step-4-copy-a-related-artifact-to-the-oci-registry class=md-nav__link> <span class=md-ellipsis> Step 4: Copy a related artifact to the OCI registry </span> </a> </li> <li class=md-nav__item> <a href=#step-5-display-the-artifact-tree class=md-nav__link> <span class=md-ellipsis> Step 5: Display the artifact tree </span> </a> </li> <li class=md-nav__item> <a href=#step-6-sign-the-image-and-artifact class=md-nav__link> <span class=md-ellipsis> Step 6: Sign the image and artifact </span> </a> </li> <li class=md-nav__item> <a href=#step-7-display-the-artifact-tree class=md-nav__link> <span class=md-ellipsis> Step 7: Display the artifact tree </span> </a> </li> <li class=md-nav__item> <a href=#step-8-end-of-demonstration class=md-nav__link> <span class=md-ellipsis> Step 8: End of demonstration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference-full-workflow-script class=md-nav__link> <span class=md-ellipsis> Reference: Full workflow script </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../security-posture/ class=md-nav__link> <span class=md-ellipsis> Security Posture </span> </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> <span class=md-ellipsis> Storage Planning </span> </a> </li> <li class=md-nav__item> <a href=../retention/ class=md-nav__link> <span class=md-ellipsis> Retention Policies </span> </a> </li> <li class=md-nav__item> <a href=../mirroring/ class=md-nav__link> <span class=md-ellipsis> Mirroring </span> </a> </li> <li class=md-nav__item> <a href=../clustering/ class=md-nav__link> <span class=md-ellipsis> Clustering </span> </a> </li> <li class=md-nav__item> <a href=../scaleout/ class=md-nav__link> <span class=md-ellipsis> Scale-out clustering </span> </a> </li> <li class=md-nav__item> <a href=../high-availability/ class=md-nav__link> <span class=md-ellipsis> Deploying a Highly Available Registry </span> </a> </li> <li class=md-nav__item> <a href=../monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../graphql/ class=md-nav__link> <span class=md-ellipsis> Using GraphQL for Enhanced Searches </span> </a> </li> <li class=md-nav__item> <a href=../benchmarking-with-zb/ class=md-nav__link> <span class=md-ellipsis> Benchmarking with zb </span> </a> </li> <li class=md-nav__item> <a href=../pprofiling/ class=md-nav__link> <span class=md-ellipsis> Performance Profiling </span> </a> </li> <li class=md-nav__item> <a href=../kind-deploy/ class=md-nav__link> <span class=md-ellipsis> Using kind for Deployment Testing </span> </a> </li> <li class=md-nav__item> <a href=../containerd/ class=md-nav__link> <span class=md-ellipsis> _containerd_ Mirroring From _zot_ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#workflow class=md-nav__link> <span class=md-ellipsis> Workflow </span> </a> <nav class=md-nav aria-label=Workflow> <ul class=md-nav__list> <li class=md-nav__item> <a href=#step-1-download-the-client-tools class=md-nav__link> <span class=md-ellipsis> Step 1: Download the client tools </span> </a> </li> <li class=md-nav__item> <a href=#step-2-deploy-an-oci-registry-with-referrers-support-zot class=md-nav__link> <span class=md-ellipsis> Step 2: Deploy an OCI registry with referrers support (zot) </span> </a> </li> <li class=md-nav__item> <a href=#step-3-copy-an-image-to-the-oci-registry class=md-nav__link> <span class=md-ellipsis> Step 3: Copy an image to the OCI registry </span> </a> </li> <li class=md-nav__item> <a href=#step-4-copy-a-related-artifact-to-the-oci-registry class=md-nav__link> <span class=md-ellipsis> Step 4: Copy a related artifact to the OCI registry </span> </a> </li> <li class=md-nav__item> <a href=#step-5-display-the-artifact-tree class=md-nav__link> <span class=md-ellipsis> Step 5: Display the artifact tree </span> </a> </li> <li class=md-nav__item> <a href=#step-6-sign-the-image-and-artifact class=md-nav__link> <span class=md-ellipsis> Step 6: Sign the image and artifact </span> </a> </li> <li class=md-nav__item> <a href=#step-7-display-the-artifact-tree class=md-nav__link> <span class=md-ellipsis> Step 7: Display the artifact tree </span> </a> </li> <li class=md-nav__item> <a href=#step-8-end-of-demonstration class=md-nav__link> <span class=md-ellipsis> Step 8: End of demonstration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reference-full-workflow-script class=md-nav__link> <span class=md-ellipsis> Reference: Full workflow script </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=software-provenance-workflow-using-oci-artifacts>Software Provenance Workflow Using OCI Artifacts<a class=headerlink href=#software-provenance-workflow-using-oci-artifacts title="Permanent link">&para;</a></h1> <blockquote> <p><img alt=👉 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f449.svg title=:point_right:> This article demonstrates an end-to-end workflow for installing a zot registry, then pushing and signing an image and a related artifact, such as an SBOM.</p> </blockquote> <h2 id=workflow>Workflow<a class=headerlink href=#workflow title="Permanent link">&para;</a></h2> <p>The following sections describe the step-by-step workflow. To view the steps combined into a single script, see <a href=#fullscript>Reference: Full workflow script</a>.</p> <p>For the workflow examples, the zot registry is assumed to be installed and running at <code>localhost:8080</code>.</p> <h3 id=step-1-download-the-client-tools>Step 1: Download the client tools<a class=headerlink href=#step-1-download-the-client-tools title="Permanent link">&para;</a></h3> <p>This workflow uses the <code>regctl</code> registry client and the <code>cosign</code> image signing tool. As a first step, we download binaries for these tools in a tools directory. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nv>TEST_TMPDIR</span><span class=o>=</span><span class=k>$(</span>mktemp<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/artifact-test-</span><span class=si>${</span><span class=nv>1</span><span class=p>:+-</span><span class=nv>$1</span><span class=si>}</span><span class=s2>.XXXXXX&quot;</span><span class=k>)</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=nv>TOOLSDIR</span><span class=o>=</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/hack/tools
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=nv>REGCLIENT</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/regctl
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=nv>REGCLIENT_VERSION</span><span class=o>=</span>v0.5.1
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>https://github.com/regclient/regclient/releases/download/<span class=si>${</span><span class=nv>REGCLIENT_VERSION</span><span class=si>}</span>/regctl-linux-amd64
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=nv>COSIGN</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/cosign
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=nv>COSIGN_VERSION</span><span class=o>=</span><span class=m>2</span>.1.1
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>https://github.com/sigstore/cosign/releases/download/v<span class=si>${</span><span class=nv>COSIGN_VERSION</span><span class=si>}</span>/cosign-linux-amd64<span class=w> </span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span>
</code></pre></div> <h3 id=step-2-deploy-an-oci-registry-with-referrers-support-zot>Step 2: Deploy an OCI registry with referrers support (zot)<a class=headerlink href=#step-2-deploy-an-oci-registry-with-referrers-support-zot title="Permanent link">&para;</a></h3> <p>Next, we execute the following tasks to deploy an OCI registry:</p> <ul> <li>Copy a zot executable binary to the server.</li> <li>Create a basic configuration file for the zot server, specifying the local root directory, the network location, and the port number.</li> <li>Launch zot with the newly-created configuration file.</li> <li>Looping with a periodic cURL query, detect when zot is up and running.</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nv>ZOT</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/zot
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nv>ZOT_VERSION</span><span class=o>=</span><span class=m>2</span>.0.0-rc6
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span><span class=w> </span>https://github.com/project-zot/zot/releases/download/v<span class=si>${</span><span class=nv>ZOT_VERSION</span><span class=si>}</span>/zot-linux-amd64-minimal
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=nv>ZOT_HOST</span><span class=o>=</span>localhost
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=nv>ZOT_PORT</span><span class=o>=</span><span class=m>8080</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=c1># function to start zot and test for readiness</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=k>function</span><span class=w> </span>zot_setup<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>cat<span class=w> </span>&gt;<span class=w> </span><span class=nv>$TEST_TMPDIR</span>/zot-config.json<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=s>{</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=s>  &quot;distSpecVersion&quot;: &quot;1.1.0-dev&quot;,</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=s>  &quot;storage&quot;: {</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=s>      &quot;rootDirectory&quot;: &quot;$TEST_TMPDIR/zot&quot;</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=s>  },</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=s>  &quot;http&quot;: {</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=s>      &quot;address&quot;: &quot;$ZOT_HOST&quot;,</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=s>      &quot;port&quot;: &quot;$ZOT_PORT&quot;</span>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=s>  },</span>
<a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=s>  &quot;log&quot;: {</span>
<a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=s>      &quot;level&quot;: &quot;error&quot;</span>
<a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=s>  }</span>
<a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=s>}</span>
<a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=s>EOF</span>
<a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>  </span><span class=c1># start zot as a background task</span>
<a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>  </span><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span><span class=w> </span>serve<span class=w> </span><span class=nv>$TEST_TMPDIR</span>/zot-config.json<span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>  </span><span class=nv>pid</span><span class=o>=</span><span class=nv>$!</span>
<a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>        </span><span class=c1># wait until service is up</span>
<a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=w>  </span><span class=nv>count</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=w>  </span><span class=nv>up</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$count</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span>/proc/<span class=nv>$pid</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a><span class=w>      </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;zot failed to start or died&quot;</span>
<a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a><span class=w>      </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a><span class=w>    </span><span class=nv>up</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a><span class=w>    </span>curl<span class=w> </span>-f<span class=w> </span>http://<span class=nv>$ZOT_HOST</span>:<span class=nv>$ZOT_PORT</span>/v2/<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nv>up</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$up</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=k>break</span><span class=p>;</span><span class=w> </span><span class=k>fi</span>
<a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a><span class=w>    </span><span class=nv>count</span><span class=o>=</span><span class=k>$((</span><span class=nv>count</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=m>1</span><span class=k>))</span>
<a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a><span class=w>  </span><span class=k>done</span>
<a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$up</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Timed out waiting for zot&quot;</span>
<a id=__codelineno-1-45 name=__codelineno-1-45 href=#__codelineno-1-45></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-1-46 name=__codelineno-1-46 href=#__codelineno-1-46></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-1-47 name=__codelineno-1-47 href=#__codelineno-1-47></a><span class=w>  </span><span class=c1># setup an OCI client</span>
<a id=__codelineno-1-48 name=__codelineno-1-48 href=#__codelineno-1-48></a><span class=w>  </span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>registry<span class=w> </span><span class=nb>set</span><span class=w> </span>--tls<span class=o>=</span>disabled<span class=w> </span><span class=nv>$ZOT_HOST</span>:<span class=nv>$ZOT_PORT</span>
<a id=__codelineno-1-49 name=__codelineno-1-49 href=#__codelineno-1-49></a><span class=o>}</span>
<a id=__codelineno-1-50 name=__codelineno-1-50 href=#__codelineno-1-50></a>
<a id=__codelineno-1-51 name=__codelineno-1-51 href=#__codelineno-1-51></a><span class=c1># call the function to start zot</span>
<a id=__codelineno-1-52 name=__codelineno-1-52 href=#__codelineno-1-52></a>zot_setup
</code></pre></div> <h3 id=step-3-copy-an-image-to-the-oci-registry>Step 3: Copy an image to the OCI registry<a class=headerlink href=#step-3-copy-an-image-to-the-oci-registry title="Permanent link">&para;</a></h3> <p>This step copies a busybox container image into the registry.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>skopeo<span class=w> </span>copy<span class=w> </span>--format<span class=o>=</span>oci<span class=w> </span>--dest-tls-verify<span class=o>=</span><span class=nb>false</span><span class=w> </span>docker://busybox:latest<span class=w> </span>docker://<span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
</code></pre></div> <h3 id=step-4-copy-a-related-artifact-to-the-oci-registry>Step 4: Copy a related artifact to the OCI registry<a class=headerlink href=#step-4-copy-a-related-artifact-to-the-oci-registry title="Permanent link">&para;</a></h3> <p>This step creates a simple artifact file and associates it with the busybox image in the registry.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>cat<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/artifact.yaml<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=s>key:</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=s>  val: artifact</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=s>EOF</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>put<span class=w> </span>--artifact-type<span class=w> </span>application/yaml<span class=w> </span>-f<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/artifact.yaml<span class=w> </span>--subject<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
</code></pre></div> <p>The <code>--subject</code> command flag associates the artifact file with the specified subject (in this case, the busybox image). If no subject is specified by the command, the artifact is considered independent and not associated with any existing image.</p> <h3 id=step-5-display-the-artifact-tree>Step 5: Display the artifact tree<a class=headerlink href=#step-5-display-the-artifact-tree title="Permanent link">&para;</a></h3> <p>This step prints the artifact tree of the busybox image. The tree includes the artifact yaml file, showing the association of the artifact to the busybox image.</p> <p>These script commands define REF0 as the artifact that was uploaded referring to the first container image. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nv>REF0</span><span class=o>=</span><span class=k>$(</span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>tree<span class=w> </span>--format<span class=w> </span><span class=s1>&#39;{{jsonPretty .}}&#39;</span><span class=w> </span>localhost:8080/busybox:latest<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>.referrer<span class=o>[</span><span class=m>0</span><span class=o>]</span>.reference.Digest<span class=k>)</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nv>REF0</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>REF0</span><span class=p>:</span><span class=nv>1</span><span class=k>:-</span><span class=nv>1</span><span class=si>}</span><span class=s2>&quot;</span>
</code></pre></div> <p>The following example shows the command and its output:</p> <div class=highlight><pre><span></span><code>$ regctl artifact tree localhost:8080/busybox:latest

Ref: localhost:8080/busybox:latest  
Digest: sha256:9172c5f692f2c65e4f773448503b21dba2de6454bd159905c4bf6d83176e4ea3
Referrers:  
   - sha256:9c0655368b10ca4b2ffe39e4dd261fb89df25a46ae92d6eb4e6e1792a451883e: application/yaml
</code></pre></div> <p>The displayed artifact tree shows that the original image (<code>localhost:8080/busybox:latest</code>) has one direct referrer (<code>sha256:9c06...883e: application/yaml</code>), the artifact yaml file.</p> <h3 id=step-6-sign-the-image-and-artifact>Step 6: Sign the image and artifact<a class=headerlink href=#step-6-sign-the-image-and-artifact title="Permanent link">&para;</a></h3> <p>This step creates a key pair for cosign in a separate directory, then uses cosign to sign both the image and the artifact file. Both signatures, like the artifact file itself, are associated with the busybox image. </p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># create a key pair in a different directory</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=nb>pushd</span><span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>generate-key-pair
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=nb>popd</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=c1># sign the image</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=nv>COSIGN_OCI_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=nv>COSIGN_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>sign<span class=w> </span>-y<span class=w> </span>--key<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/cosign.key<span class=w> </span>--registry-referrers-mode<span class=o>=</span>oci-1-1<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=c1># sign the artifact referring to the image</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=nv>COSIGN_OCI_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=nv>COSIGN_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>sign<span class=w> </span>-y<span class=w> </span>--key<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/cosign.key<span class=w> </span>--registry-referrers-mode<span class=o>=</span>oci-1-1<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox@<span class=si>${</span><span class=nv>REF0</span><span class=si>}</span>
</code></pre></div> <h3 id=step-7-display-the-artifact-tree>Step 7: Display the artifact tree<a class=headerlink href=#step-7-display-the-artifact-tree title="Permanent link">&para;</a></h3> <p>This step again prints the artifact tree, which should now show the artifact and the two signatures, all associated to the busybox image.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>tree<span class=w> </span>localhost:8080/busybox:latest
</code></pre></div> <p>The following example shows the command and its output:</p> <div class=highlight><pre><span></span><code>$ regctl artifact tree localhost:8080/busybox:latest

Ref: localhost:8080/busybox:latest
Digest: sha256:9172c5f692f2c65e4f773448503b21dba2de6454bd159905c4bf6d83176e4ea3
Referrers:
  - sha256:9c0655368b10ca4b2ffe39e4dd261fb89df25a46ae92d6eb4e6e1792a451883e: application/yaml
    Referrers:
      - sha256:06792b209137486442a2b804b2225c0014e3e238d363cdbea088bbd73207fb34: application/vnd.dev.cosign.artifact.sig.v1+json
  - sha256:995b6a78bf04a7a9676dac76b4598ccb645c17e30b02f294de9fdfa2f28eb7b2: application/vnd.dev.cosign.artifact.sig.v1+json
</code></pre></div> <p>The displayed artifact tree shows that the original image now has two direct referrers &mdash; the artifact and the cosign signature of the original image. In addition, there is a second-level referrer &mdash; the cosign signature of the artifact, which is a referrer of the artifact file.</p> <h3 id=step-8-end-of-demonstration>Step 8: End of demonstration<a class=headerlink href=#step-8-end-of-demonstration title="Permanent link">&para;</a></h3> <p>This step halts the zot registry server, ending the workflow demonstration.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># function for stopping zot after demonstration</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>function</span><span class=w> </span>zot_teardown<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>  </span>killall<span class=w> </span>zot
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=o>}</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=c1># stop zot</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>zot_teardown
</code></pre></div> <p><a name=fullscript></a></p> <h2 id=reference-full-workflow-script>Reference: Full workflow script<a class=headerlink href=#reference-full-workflow-script title="Permanent link">&para;</a></h2> <p>Expand the text box below to view the entire workflow as a single executable shell script.</p> <blockquote> <p><img alt=💡 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f4a1.svg title=:bulb:> To copy the script to the clipboard, click the copy icon that appears in the upper right corner of the expanded text box.</p> </blockquote> <details> <summary markdown=span>Click here to view the all-in-one script</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=ch>#!/bin/bash -xe</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=nv>TEST_TMPDIR</span><span class=o>=</span><span class=k>$(</span>mktemp<span class=w> </span>-d<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>PWD</span><span class=si>}</span><span class=s2>/artifact-test-</span><span class=si>${</span><span class=nv>1</span><span class=p>:+-</span><span class=nv>$1</span><span class=si>}</span><span class=s2>.XXXXXX&quot;</span><span class=k>)</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=nv>TOOLSDIR</span><span class=o>=</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>/hack/tools
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>mkdir<span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=nv>REGCLIENT</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/regctl
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=nv>REGCLIENT_VERSION</span><span class=o>=</span>v0.5.1
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>https://github.com/regclient/regclient/releases/download/<span class=si>${</span><span class=nv>REGCLIENT_VERSION</span><span class=si>}</span>/regctl-linux-amd64
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=nv>COSIGN</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/cosign
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=nv>COSIGN_VERSION</span><span class=o>=</span><span class=m>2</span>.1.1
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>https://github.com/sigstore/cosign/releases/download/v<span class=si>${</span><span class=nv>COSIGN_VERSION</span><span class=si>}</span>/cosign-linux-amd64<span class=w> </span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=c1># OCI registry</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=nv>ZOT</span><span class=o>=</span><span class=si>${</span><span class=nv>TOOLSDIR</span><span class=si>}</span>/bin/zot
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=nv>ZOT_VERSION</span><span class=o>=</span><span class=m>2</span>.0.0-rc6
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>curl<span class=w> </span>-Lo<span class=w> </span><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span><span class=w> </span>https://github.com/project-zot/zot/releases/download/v<span class=si>${</span><span class=nv>ZOT_VERSION</span><span class=si>}</span>/zot-linux-amd64-minimal
<a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>chmod<span class=w> </span>+x<span class=w> </span><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span>
<a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>
<a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=nv>ZOT_HOST</span><span class=o>=</span>localhost
<a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=nv>ZOT_PORT</span><span class=o>=</span><span class=m>8080</span>
<a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>
<a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=k>function</span><span class=w> </span>zot_setup<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>cat<span class=w> </span>&gt;<span class=w> </span><span class=nv>$TEST_TMPDIR</span>/zot-config.json<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=s>{</span>
<a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=s>  &quot;distSpecVersion&quot;: &quot;1.1.0-dev&quot;,</span>
<a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=s>  &quot;storage&quot;: {</span>
<a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=s>      &quot;rootDirectory&quot;: &quot;$TEST_TMPDIR/zot&quot;</span>
<a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=s>  },</span>
<a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a><span class=s>  &quot;http&quot;: {</span>
<a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a><span class=s>      &quot;address&quot;: &quot;$ZOT_HOST&quot;,</span>
<a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a><span class=s>      &quot;port&quot;: &quot;$ZOT_PORT&quot;</span>
<a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a><span class=s>  },</span>
<a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a><span class=s>  &quot;log&quot;: {</span>
<a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a><span class=s>      &quot;level&quot;: &quot;error&quot;</span>
<a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a><span class=s>  }</span>
<a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a><span class=s>}</span>
<a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a><span class=s>EOF</span>
<a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a><span class=c1># start as a background task</span>
<a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a><span class=si>${</span><span class=nv>ZOT</span><span class=si>}</span><span class=w> </span>serve<span class=w> </span><span class=nv>$TEST_TMPDIR</span>/zot-config.json<span class=w> </span><span class=p>&amp;</span>
<a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a><span class=nv>pid</span><span class=o>=</span><span class=nv>$!</span>
<a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a><span class=w>        </span><span class=c1># wait until service is up</span>
<a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a><span class=nv>count</span><span class=o>=</span><span class=m>5</span>
<a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a><span class=nv>up</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a><span class=k>while</span><span class=w> </span><span class=o>[[</span><span class=w> </span><span class=nv>$count</span><span class=w> </span>-gt<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]]</span><span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-d<span class=w> </span>/proc/<span class=nv>$pid</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;zot failed to start or died&quot;</span>
<a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-8-53 name=__codelineno-8-53 href=#__codelineno-8-53></a><span class=w>    </span><span class=k>fi</span>
<a id=__codelineno-8-54 name=__codelineno-8-54 href=#__codelineno-8-54></a><span class=w>    </span><span class=nv>up</span><span class=o>=</span><span class=m>1</span>
<a id=__codelineno-8-55 name=__codelineno-8-55 href=#__codelineno-8-55></a><span class=w>    </span>curl<span class=w> </span>-f<span class=w> </span>http://<span class=nv>$ZOT_HOST</span>:<span class=nv>$ZOT_PORT</span>/v2/<span class=w> </span><span class=o>||</span><span class=w> </span><span class=nv>up</span><span class=o>=</span><span class=m>0</span>
<a id=__codelineno-8-56 name=__codelineno-8-56 href=#__codelineno-8-56></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$up</span><span class=w> </span>-eq<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=k>break</span><span class=p>;</span><span class=w> </span><span class=k>fi</span>
<a id=__codelineno-8-57 name=__codelineno-8-57 href=#__codelineno-8-57></a><span class=w>    </span>sleep<span class=w> </span><span class=m>1</span>
<a id=__codelineno-8-58 name=__codelineno-8-58 href=#__codelineno-8-58></a><span class=w>    </span><span class=nv>count</span><span class=o>=</span><span class=k>$((</span><span class=nv>count</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=m>1</span><span class=k>))</span>
<a id=__codelineno-8-59 name=__codelineno-8-59 href=#__codelineno-8-59></a><span class=k>done</span>
<a id=__codelineno-8-60 name=__codelineno-8-60 href=#__codelineno-8-60></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=nv>$up</span><span class=w> </span>-eq<span class=w> </span><span class=m>0</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-8-61 name=__codelineno-8-61 href=#__codelineno-8-61></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Timed out waiting for zot&quot;</span>
<a id=__codelineno-8-62 name=__codelineno-8-62 href=#__codelineno-8-62></a><span class=w>    </span><span class=nb>exit</span><span class=w> </span><span class=m>1</span>
<a id=__codelineno-8-63 name=__codelineno-8-63 href=#__codelineno-8-63></a><span class=k>fi</span>
<a id=__codelineno-8-64 name=__codelineno-8-64 href=#__codelineno-8-64></a><span class=c1># setup a OCI client</span>
<a id=__codelineno-8-65 name=__codelineno-8-65 href=#__codelineno-8-65></a><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>registry<span class=w> </span><span class=nb>set</span><span class=w> </span>--tls<span class=o>=</span>disabled<span class=w> </span><span class=nv>$ZOT_HOST</span>:<span class=nv>$ZOT_PORT</span>
<a id=__codelineno-8-66 name=__codelineno-8-66 href=#__codelineno-8-66></a><span class=o>}</span>
<a id=__codelineno-8-67 name=__codelineno-8-67 href=#__codelineno-8-67></a>
<a id=__codelineno-8-68 name=__codelineno-8-68 href=#__codelineno-8-68></a><span class=c1># function for stopping zot after demonstration</span>
<a id=__codelineno-8-69 name=__codelineno-8-69 href=#__codelineno-8-69></a><span class=k>function</span><span class=w> </span>zot_teardown<span class=o>()</span><span class=w> </span><span class=o>{</span>
<a id=__codelineno-8-70 name=__codelineno-8-70 href=#__codelineno-8-70></a>killall<span class=w> </span>zot
<a id=__codelineno-8-71 name=__codelineno-8-71 href=#__codelineno-8-71></a><span class=o>}</span>
<a id=__codelineno-8-72 name=__codelineno-8-72 href=#__codelineno-8-72></a>
<a id=__codelineno-8-73 name=__codelineno-8-73 href=#__codelineno-8-73></a><span class=c1># call the function to start zot</span>
<a id=__codelineno-8-74 name=__codelineno-8-74 href=#__codelineno-8-74></a>zot_setup
<a id=__codelineno-8-75 name=__codelineno-8-75 href=#__codelineno-8-75></a>
<a id=__codelineno-8-76 name=__codelineno-8-76 href=#__codelineno-8-76></a><span class=c1># copy an image</span>
<a id=__codelineno-8-77 name=__codelineno-8-77 href=#__codelineno-8-77></a>skopeo<span class=w> </span>copy<span class=w> </span>--format<span class=o>=</span>oci<span class=w> </span>--dest-tls-verify<span class=o>=</span><span class=nb>false</span><span class=w> </span>docker://busybox:latest<span class=w> </span>docker://<span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
<a id=__codelineno-8-78 name=__codelineno-8-78 href=#__codelineno-8-78></a>
<a id=__codelineno-8-79 name=__codelineno-8-79 href=#__codelineno-8-79></a><span class=c1># copy an artifact referring to the above image</span>
<a id=__codelineno-8-80 name=__codelineno-8-80 href=#__codelineno-8-80></a>cat<span class=w> </span>&gt;<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/artifact.yaml<span class=w> </span><span class=s>&lt;&lt; EOF</span>
<a id=__codelineno-8-81 name=__codelineno-8-81 href=#__codelineno-8-81></a><span class=s>key:</span>
<a id=__codelineno-8-82 name=__codelineno-8-82 href=#__codelineno-8-82></a><span class=s>val: artifact</span>
<a id=__codelineno-8-83 name=__codelineno-8-83 href=#__codelineno-8-83></a><span class=s>EOF</span>
<a id=__codelineno-8-84 name=__codelineno-8-84 href=#__codelineno-8-84></a><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>put<span class=w> </span>--artifact-type<span class=w> </span>application/yaml<span class=w> </span>-f<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/artifact.yaml<span class=w> </span>--subject<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
<a id=__codelineno-8-85 name=__codelineno-8-85 href=#__codelineno-8-85></a><span class=nv>REF0</span><span class=o>=</span><span class=k>$(</span><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>tree<span class=w> </span>--format<span class=w> </span><span class=s1>&#39;{{jsonPretty .}}&#39;</span><span class=w> </span>localhost:8080/busybox:latest<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>.referrer<span class=o>[</span><span class=m>0</span><span class=o>]</span>.reference.Digest<span class=k>)</span>
<a id=__codelineno-8-86 name=__codelineno-8-86 href=#__codelineno-8-86></a><span class=nv>REF0</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>REF0</span><span class=p>:</span><span class=nv>1</span><span class=k>:-</span><span class=nv>1</span><span class=si>}</span><span class=s2>&quot;</span>
<a id=__codelineno-8-87 name=__codelineno-8-87 href=#__codelineno-8-87></a>
<a id=__codelineno-8-88 name=__codelineno-8-88 href=#__codelineno-8-88></a><span class=c1># create a key pair in a different directory</span>
<a id=__codelineno-8-89 name=__codelineno-8-89 href=#__codelineno-8-89></a><span class=nb>pushd</span><span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>
<a id=__codelineno-8-90 name=__codelineno-8-90 href=#__codelineno-8-90></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>generate-key-pair
<a id=__codelineno-8-91 name=__codelineno-8-91 href=#__codelineno-8-91></a><span class=nb>popd</span>
<a id=__codelineno-8-92 name=__codelineno-8-92 href=#__codelineno-8-92></a><span class=c1># sign the image</span>
<a id=__codelineno-8-93 name=__codelineno-8-93 href=#__codelineno-8-93></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=nv>COSIGN_OCI_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=nv>COSIGN_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>sign<span class=w> </span>-y<span class=w> </span>--key<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/cosign.key<span class=w> </span>--registry-referrers-mode<span class=o>=</span>oci-1-1<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox:latest
<a id=__codelineno-8-94 name=__codelineno-8-94 href=#__codelineno-8-94></a><span class=c1># sign the artifact referring to the image</span>
<a id=__codelineno-8-95 name=__codelineno-8-95 href=#__codelineno-8-95></a><span class=nv>COSIGN_PASSWORD</span><span class=o>=</span><span class=w> </span><span class=nv>COSIGN_OCI_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=nv>COSIGN_EXPERIMENTAL</span><span class=o>=</span><span class=m>1</span><span class=w> </span><span class=si>${</span><span class=nv>COSIGN</span><span class=si>}</span><span class=w> </span>sign<span class=w> </span>-y<span class=w> </span>--key<span class=w> </span><span class=si>${</span><span class=nv>TEST_TMPDIR</span><span class=si>}</span>/cosign.key<span class=w> </span>--registry-referrers-mode<span class=o>=</span>oci-1-1<span class=w> </span><span class=si>${</span><span class=nv>ZOT_HOST</span><span class=si>}</span>:<span class=si>${</span><span class=nv>ZOT_PORT</span><span class=si>}</span>/busybox@<span class=si>${</span><span class=nv>REF0</span><span class=si>}</span>
<a id=__codelineno-8-96 name=__codelineno-8-96 href=#__codelineno-8-96></a>
<a id=__codelineno-8-97 name=__codelineno-8-97 href=#__codelineno-8-97></a><span class=c1># list the reference tree</span>
<a id=__codelineno-8-98 name=__codelineno-8-98 href=#__codelineno-8-98></a><span class=si>${</span><span class=nv>REGCLIENT</span><span class=si>}</span><span class=w> </span>artifact<span class=w> </span>tree<span class=w> </span>localhost:8080/busybox:latest
<a id=__codelineno-8-99 name=__codelineno-8-99 href=#__codelineno-8-99></a>
<a id=__codelineno-8-100 name=__codelineno-8-100 href=#__codelineno-8-100></a><span class=c1># stop zot</span>
<a id=__codelineno-8-101 name=__codelineno-8-101 href=#__codelineno-8-101></a>zot_teardown
</code></pre></div> </details> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 6, 2023</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2019 - 2025 The zot project authors, All Rights Reserved. | The Linux Foundation® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> </div> </div> <div class=md-social> <a href=https://github.com/project-zot/zot.git target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/zothub target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://cloud-native.slack.com/archives/C03EGRE4QGH target=_blank rel=noopener title=cloud-native.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "toc.follow", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.471ce7a9.min.js></script> </body> </html>