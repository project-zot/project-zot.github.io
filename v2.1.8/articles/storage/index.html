<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Zot Registry"><link href=https://zotregistry.dev/v2.1.8/articles/storage/ rel=canonical><link href=../security-posture/ rel=prev><link href=../retention/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.32"><title>Storage Planning - zotregistry.dev</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#storage-planning-with-zot class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=https://zotregistry.dev title=zotregistry.dev class="md-header__button md-logo" aria-label=zotregistry.dev data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> zotregistry.dev </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Storage Planning </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/project-zot/zot title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> project-zot/zot </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://zotregistry.dev title=zotregistry.dev class="md-nav__button md-logo" aria-label=zotregistry.dev data-md-component=logo> <img src=../../assets/images/logo.svg alt=logo> </a> zotregistry.dev </label> <div class=md-nav__source> <a href=https://github.com/project-zot/zot title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> project-zot/zot </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../general/whats-new/ class=md-nav__link> <span class=md-ellipsis> What's New </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> General </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> General </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../general/concepts/ class=md-nav__link> <span class=md-ellipsis> Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../general/features/ class=md-nav__link> <span class=md-ellipsis> Key Features </span> </a> </li> <li class=md-nav__item> <a href=../../general/architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../general/extensions/ class=md-nav__link> <span class=md-ellipsis> Extensions </span> </a> </li> <li class=md-nav__item> <a href=../../general/releases/ class=md-nav__link> <span class=md-ellipsis> Released Images </span> </a> </li> <li class=md-nav__item> <a href=../../general/glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../general/project/ class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> User Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guides/user-guide-datapath/ class=md-nav__link> <span class=md-ellipsis> Push and Pull Image Content </span> </a> </li> <li class=md-nav__item> <a href=../../user-guides/user-guide-gui/ class=md-nav__link> <span class=md-ellipsis> Use the Web Interface to Find Images </span> </a> </li> <li class=md-nav__item> <a href=../../user-guides/zli/ class=md-nav__link> <span class=md-ellipsis> Command Line (zli) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Installation Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Installation Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../install-guides/install-guide-linux/ class=md-nav__link> <span class=md-ellipsis> Installing zot on Bare Metal Linux </span> </a> </li> <li class=md-nav__item> <a href=../../install-guides/install-guide-k8s/ class=md-nav__link> <span class=md-ellipsis> Installing zot with Kubernetes and Helm </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Administrator Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Administrator Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../admin-guide/admin-getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../admin-guide/admin-configuration/ class=md-nav__link> <span class=md-ellipsis> Configuring zot </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Developer Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Developer Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guide/onboarding/ class=md-nav__link> <span class=md-ellipsis> Onboarding </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/extensions-dev/ class=md-nav__link> <span class=md-ellipsis> Extensions </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/api-user-guide/ class=md-nav__link> <span class=md-ellipsis> Using the API </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Articles </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Articles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../building-ci-cd-pipeline/ class=md-nav__link> <span class=md-ellipsis> CI/CD Pipeline </span> </a> </li> <li class=md-nav__item> <a href=../authn-authz/ class=md-nav__link> <span class=md-ellipsis> Authentication and Authorization </span> </a> </li> <li class=md-nav__item> <a href=../verifying-signatures/ class=md-nav__link> <span class=md-ellipsis> Verifying Image Signatures </span> </a> </li> <li class=md-nav__item> <a href=../immutable-tags/ class=md-nav__link> <span class=md-ellipsis> Immutable Tags </span> </a> </li> <li class=md-nav__item> <a href=../workflow/ class=md-nav__link> <span class=md-ellipsis> Software Provenance Workflow Using OCI Artifacts </span> </a> </li> <li class=md-nav__item> <a href=../security-posture/ class=md-nav__link> <span class=md-ellipsis> Security Posture </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Storage Planning </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Storage Planning </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#storage-model class=md-nav__link> <span class=md-ellipsis> Storage model </span> </a> <nav class=md-nav aria-label="Storage model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hosting-an-oci-image-layout class=md-nav__link> <span class=md-ellipsis> Hosting an OCI image layout </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-features class=md-nav__link> <span class=md-ellipsis> Storage features </span> </a> <nav class=md-nav aria-label="Storage features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#commit class=md-nav__link> <span class=md-ellipsis> Commit </span> </a> </li> <li class=md-nav__item> <a href=#deduplication class=md-nav__link> <span class=md-ellipsis> Deduplication </span> </a> </li> <li class=md-nav__item> <a href=#garbage-collection class=md-nav__link> <span class=md-ellipsis> Garbage collection </span> </a> </li> <li class=md-nav__item> <a href=#scrub class=md-nav__link> <span class=md-ellipsis> Scrub </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-backends class=md-nav__link> <span class=md-ellipsis> Storage backends </span> </a> <nav class=md-nav aria-label="Storage backends"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-filesystem class=md-nav__link> <span class=md-ellipsis> Local filesystem </span> </a> </li> <li class=md-nav__item> <a href=#remote-filesystem class=md-nav__link> <span class=md-ellipsis> Remote filesystem </span> </a> <nav class=md-nav aria-label="Remote filesystem"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-configuration-for-remote-s3-storage class=md-nav__link> <span class=md-ellipsis> Example: configuration for remote (s3) storage </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-zot-storage class=md-nav__link> <span class=md-ellipsis> Configuring zot storage </span> </a> <nav class=md-nav aria-label="Configuring zot storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configurable-attributes class=md-nav__link> <span class=md-ellipsis> Configurable attributes </span> </a> </li> <li class=md-nav__item> <a href=#configuring-garbage-collection class=md-nav__link> <span class=md-ellipsis> Configuring garbage collection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-remote-storage-with-s3 class=md-nav__link> <span class=md-ellipsis> Configuring remote storage with s3 </span> </a> <nav class=md-nav aria-label="Configuring remote storage with s3"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#s3-credentials class=md-nav__link> <span class=md-ellipsis> s3 Credentials </span> </a> </li> <li class=md-nav__item> <a href=#s3-permissions-scopes class=md-nav__link> <span class=md-ellipsis> S3 permissions scopes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cache-drivers class=md-nav__link> <span class=md-ellipsis> Cache drivers </span> </a> <nav class=md-nav aria-label="Cache drivers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boltdb class=md-nav__link> <span class=md-ellipsis> BoltDB </span> </a> </li> <li class=md-nav__item> <a href=#dynamodb class=md-nav__link> <span class=md-ellipsis> DynamoDB </span> </a> <nav class=md-nav aria-label=DynamoDB> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dynamodb-permission-scopes class=md-nav__link> <span class=md-ellipsis> DynamoDB permission scopes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#redis class=md-nav__link> <span class=md-ellipsis> Redis </span> </a> <nav class=md-nav aria-label=Redis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-cluster-configuration class=md-nav__link> <span class=md-ellipsis> Redis cluster configuration </span> </a> </li> <li class=md-nav__item> <a href=#add-redis-configuration-parameters class=md-nav__link> <span class=md-ellipsis> Add Redis configuration parameters </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#remote-storage-subpaths class=md-nav__link> <span class=md-ellipsis> Remote storage subpaths </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../retention/ class=md-nav__link> <span class=md-ellipsis> Retention Policies </span> </a> </li> <li class=md-nav__item> <a href=../mirroring/ class=md-nav__link> <span class=md-ellipsis> Mirroring </span> </a> </li> <li class=md-nav__item> <a href=../clustering/ class=md-nav__link> <span class=md-ellipsis> Clustering </span> </a> </li> <li class=md-nav__item> <a href=../scaleout/ class=md-nav__link> <span class=md-ellipsis> Scale-out clustering </span> </a> </li> <li class=md-nav__item> <a href=../high-availability/ class=md-nav__link> <span class=md-ellipsis> Deploying a Highly Available Registry </span> </a> </li> <li class=md-nav__item> <a href=../monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../graphql/ class=md-nav__link> <span class=md-ellipsis> Using GraphQL for Enhanced Searches </span> </a> </li> <li class=md-nav__item> <a href=../benchmarking-with-zb/ class=md-nav__link> <span class=md-ellipsis> Benchmarking with zb </span> </a> </li> <li class=md-nav__item> <a href=../pprofiling/ class=md-nav__link> <span class=md-ellipsis> Performance Profiling </span> </a> </li> <li class=md-nav__item> <a href=../kind-deploy/ class=md-nav__link> <span class=md-ellipsis> Using kind for Deployment Testing </span> </a> </li> <li class=md-nav__item> <a href=../containerd/ class=md-nav__link> <span class=md-ellipsis> _containerd_ Mirroring From _zot_ </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#storage-model class=md-nav__link> <span class=md-ellipsis> Storage model </span> </a> <nav class=md-nav aria-label="Storage model"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hosting-an-oci-image-layout class=md-nav__link> <span class=md-ellipsis> Hosting an OCI image layout </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-features class=md-nav__link> <span class=md-ellipsis> Storage features </span> </a> <nav class=md-nav aria-label="Storage features"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#commit class=md-nav__link> <span class=md-ellipsis> Commit </span> </a> </li> <li class=md-nav__item> <a href=#deduplication class=md-nav__link> <span class=md-ellipsis> Deduplication </span> </a> </li> <li class=md-nav__item> <a href=#garbage-collection class=md-nav__link> <span class=md-ellipsis> Garbage collection </span> </a> </li> <li class=md-nav__item> <a href=#scrub class=md-nav__link> <span class=md-ellipsis> Scrub </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-backends class=md-nav__link> <span class=md-ellipsis> Storage backends </span> </a> <nav class=md-nav aria-label="Storage backends"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#local-filesystem class=md-nav__link> <span class=md-ellipsis> Local filesystem </span> </a> </li> <li class=md-nav__item> <a href=#remote-filesystem class=md-nav__link> <span class=md-ellipsis> Remote filesystem </span> </a> <nav class=md-nav aria-label="Remote filesystem"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-configuration-for-remote-s3-storage class=md-nav__link> <span class=md-ellipsis> Example: configuration for remote (s3) storage </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-zot-storage class=md-nav__link> <span class=md-ellipsis> Configuring zot storage </span> </a> <nav class=md-nav aria-label="Configuring zot storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configurable-attributes class=md-nav__link> <span class=md-ellipsis> Configurable attributes </span> </a> </li> <li class=md-nav__item> <a href=#configuring-garbage-collection class=md-nav__link> <span class=md-ellipsis> Configuring garbage collection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuring-remote-storage-with-s3 class=md-nav__link> <span class=md-ellipsis> Configuring remote storage with s3 </span> </a> <nav class=md-nav aria-label="Configuring remote storage with s3"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#s3-credentials class=md-nav__link> <span class=md-ellipsis> s3 Credentials </span> </a> </li> <li class=md-nav__item> <a href=#s3-permissions-scopes class=md-nav__link> <span class=md-ellipsis> S3 permissions scopes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cache-drivers class=md-nav__link> <span class=md-ellipsis> Cache drivers </span> </a> <nav class=md-nav aria-label="Cache drivers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boltdb class=md-nav__link> <span class=md-ellipsis> BoltDB </span> </a> </li> <li class=md-nav__item> <a href=#dynamodb class=md-nav__link> <span class=md-ellipsis> DynamoDB </span> </a> <nav class=md-nav aria-label=DynamoDB> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dynamodb-permission-scopes class=md-nav__link> <span class=md-ellipsis> DynamoDB permission scopes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#redis class=md-nav__link> <span class=md-ellipsis> Redis </span> </a> <nav class=md-nav aria-label=Redis> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-cluster-configuration class=md-nav__link> <span class=md-ellipsis> Redis cluster configuration </span> </a> </li> <li class=md-nav__item> <a href=#add-redis-configuration-parameters class=md-nav__link> <span class=md-ellipsis> Add Redis configuration parameters </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#remote-storage-subpaths class=md-nav__link> <span class=md-ellipsis> Remote storage subpaths </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=storage-planning-with-zot>Storage Planning with zot<a class=headerlink href=#storage-planning-with-zot title="Permanent link">&para;</a></h1> <blockquote> <p><img alt=ðŸ‘‰ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f449.svg title=:point_right:> zot supports the following features to provide OCI standards-based, vendor-agnostic image storage:</p> <ul> <li>Local and remote file storage</li> <li>Inline deduplication and garbage collection</li> <li>Data scrubbing in background</li> </ul> </blockquote> <h2 id=storage-model>Storage model<a class=headerlink href=#storage-model title="Permanent link">&para;</a></h2> <p>Data handling in zot revolves around two main principles: that data and APIs on the wire conform to the OCI Distribution Specification and that data on the disk conforms to the OCI Image Layout Specification. As a result, any client that is compliant with the Distribution Specification can read from or write to a zot registry. Furthermore, the actual storage is simply an OCI Image Layout. With only these two specification documents in hand, the entire data flow inside can be easily understood.</p> <blockquote> <p><img alt=âœ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/270f.svg title=:pencil2:> zot does not implement, support, or require any vendor-specific protocols, including that of Docker.</p> </blockquote> <h3 id=hosting-an-oci-image-layout>Hosting an OCI image layout<a class=headerlink href=#hosting-an-oci-image-layout title="Permanent link">&para;</a></h3> <p>Because zot supports the OCI image layout, it can readily host and serve any directories holding a valid OCI image layout even when those directories have been created elsewhere. This property of zot is suitable for use cases in which container images are independently built, stored, and transferred, but later need to be served over the network.</p> <h2 id=storage-features>Storage features<a class=headerlink href=#storage-features title="Permanent link">&para;</a></h2> <p>Exposing flexibility in storage capabilities is a key tenet for catering to the requirements of varied environments ranging from cloud to on-premises to IoT.</p> <h4 id=commit>Commit<a class=headerlink href=#commit title="Permanent link">&para;</a></h4> <p>Most modern filesystems buffer and flush RAM data to disk after a delay. The purpose of this function is to improve performance at the cost of higher disk memory usage. In embedded devices such as Raspberry Pi, for example, where RAM may be very limited and at a premium, it is desirable to flush data to disk more frequently. The zot storage configuration exposes an option called <code>commit</code> which, when enabled, causes data writes to be committed to disk immediately. This option is disabled by default.</p> <h4 id=deduplication>Deduplication<a class=headerlink href=#deduplication title="Permanent link">&para;</a></h4> <p>Deduplication is a storage space saving feature wherein only a single copy of specific content is maintained on disk while many different image manifests may hold references to that same content. The deduplication option (<code>dedupe</code>) is also available for supported cloud storage backends.</p> <p>Upon startup, zot enforces the <code>dedupe</code> status on the existing storage. If the <code>dedupe</code> status upon startup is <code>true</code>, zot deduplicates all blobs found in storage, both local and remote. If the status upon startup is <code>false</code>, zot restores cloud storage blobs to their original state. There is no need for zot to restore local filesystem storage if hard links are used.</p> <h4 id=garbage-collection>Garbage collection<a class=headerlink href=#garbage-collection title="Permanent link">&para;</a></h4> <p>After an image is deleted by deleting an image manifest, the corresponding blobs can be purged to free up space. However, since Distribution Specification APIs are not transactional between blob and manifest lifecycle, care must be taken so as not to put the storage in an inconsistent state. Garbage collection in zot is an inline feature meaning that it is <strong>not</strong> necessary to take the registry offline. See <a href=#config-gc><i>Configuring garbage collection</i></a> for details. </p> <h4 id=scrub>Scrub<a class=headerlink href=#scrub title="Permanent link">&para;</a></h4> <p>The <code>scrub</code> function, available as an <em>extension</em>, makes it possible to ascertain data validity by computing hashes on blobs periodically and continuously so that any bit rot is caught and reported early.</p> <h2 id=storage-backends>Storage backends<a class=headerlink href=#storage-backends title="Permanent link">&para;</a></h2> <p>The following types of storage backends are supported.</p> <h3 id=local-filesystem>Local filesystem<a class=headerlink href=#local-filesystem title="Permanent link">&para;</a></h3> <p>zot can store and serve files from one or more local directories. A minimum of one root directory is required for local hosting, but additional hosted directories can be added. When accessed by HTTP APIs, all directories can appear as a single data store.</p> <blockquote> <p><img alt=âœ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/270f.svg title=:pencil2:> Remote filesystems that are mounted and accessible locally such as <code>NFS</code> or <code>fuse</code> are treated as local filesystems.</p> </blockquote> <h3 id=remote-filesystem>Remote filesystem<a class=headerlink href=#remote-filesystem title="Permanent link">&para;</a></h3> <p>zot can also store data remotely in the cloud, using the storage APIs of the cloud service. Currently, zot supports only the AWS s3 storage service.</p> <h4 id=example-configuration-for-remote-s3-storage>Example: configuration for remote (s3) storage<a class=headerlink href=#example-configuration-for-remote-s3-storage title="Permanent link">&para;</a></h4> <details> <summary markdown=span>Click here to view a sample zot configuration for remote storage.</summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=p>{</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=nt>&quot;distSpecVersion&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.0.1-dev&quot;</span><span class=p>,</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>        </span><span class=nt>&quot;dedupe&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>        </span><span class=nt>&quot;storageDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3&quot;</span><span class=p>,</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>            </span><span class=nt>&quot;rootdirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>            </span><span class=nt>&quot;bucket&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot-storage&quot;</span><span class=p>,</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>            </span><span class=nt>&quot;secure&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>            </span><span class=nt>&quot;skipverify&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;dynamodb&quot;</span><span class=p>,</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>            </span><span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;http://localhost:4566&quot;</span><span class=p>,</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>            </span><span class=nt>&quot;tableName&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;MainTable&quot;</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=w>    </span><span class=nt>&quot;http&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=w>        </span><span class=nt>&quot;address&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;127.0.0.1&quot;</span><span class=p>,</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=w>        </span><span class=nt>&quot;port&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;8080&quot;</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>    </span><span class=nt>&quot;log&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=w>        </span><span class=nt>&quot;level&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;debug&quot;</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=p>}</span>
</code></pre></div> </details> <h2 id=configuring-zot-storage>Configuring zot storage<a class=headerlink href=#configuring-zot-storage title="Permanent link">&para;</a></h2> <p>Filesystem storage is configured with the <code>storage</code> attribute in the zot configuration file, as shown in the following example.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:{</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>        </span><span class=nt>&quot;commit&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>        </span><span class=nt>&quot;dedupe&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>        </span><span class=nt>&quot;gc&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>        </span><span class=nt>&quot;gcDelay&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1h&quot;</span><span class=p>,</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>        </span><span class=nt>&quot;gcInterval&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;24h&quot;</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=p>}</span>
</code></pre></div> <h3 id=configurable-attributes>Configurable attributes<a class=headerlink href=#configurable-attributes title="Permanent link">&para;</a></h3> <p>The following table lists the attributes of the <code>storage</code> configuration.</p> <table> <colgroup> <col style="width: 25%"> <col style="width: 75%"> </colgroup> <thead> <tr class=header> <th style="text-align: left;">Attribute</th> <th style="text-align: left;">Description</th> </tr> </thead> <tbody> <tr class=odd> <td style="text-align: left;"><p><code>rootDirectory</code></p></td> <td style="text-align: left;"><p>Location of the images stored in the server file system.</p></td> </tr> <tr class=even> <td style="text-align: left;"><p><code>commit</code></p></td> <td style="text-align: left;"><p>For faster performance, data written by zot is retained in memory before being periodically committed to disk by the operating system. To eliminate this retention time and cause data to be written to disk immediately, set to <code>true</code>. This prevents data loss but reduces performance.</p></td> </tr> <tr class=odd> <td style="text-align: left;"><p><code>dedupe</code></p></td> <td style="text-align: left;"><p>If the server filesystem supports hard links, you can optimize storage space by enabling inline deduplication of layers and blobs that are shared among multiple container images. Deduplication is enabled by default. Set to <code>false</code> to disable deduplication.</p></td> </tr> <tr class=even> <td style="text-align: left;"><p><code>gc</code></p></td> <td style="text-align: left;"><p>When an image is deleted, either by tag or by reference, orphaned blobs can lead to wasted storage. Garbage collection (gc) is enabled by default to reclaim this space. Set to <code>false</code> to disable garbage collection.</p></td> </tr> <tr class=odd> <td style="text-align: left;"><p><code>gcDelay</code></p></td> <td style="text-align: left;"><p>(Optional) If garbage collection is enabled, causes it to run once after the specified delay time. The default is 1 hour. Requires the <code>gc</code> attribute to be <code>true</code>.</p></td> </tr> <tr class=even> <td style="text-align: left;"><p><code>gcInterval</code></p></td> <td style="text-align: left;"><p>(Optional) If garbage collection is enabled, causes periodic collection at the specified interval. Must be set based on use cases and user workloads. If no value is specified, there is no periodic collection. Requires the <code>gc</code> attribute to be <code>true</code>.</p></td> </tr> <tr class=odd> <td style="text-align: left;"><p><code>subpaths</code></p></td> <td style="text-align: left;"><p>You can store and serve images from multiple filesystems, each with their own repository paths and settings. The following example shows three subpaths.</p> <div class=sourceCode id=cb1><pre class="sourceCode json"><code class="sourceCode json"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=er>&quot;storage&quot;:</span><span class=fu>{</span></span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a>  <span class=dt>&quot;subPaths&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true tabindex=-1></a>    <span class=dt>&quot;/a&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;rootDirectory&quot;</span><span class=fu>:</span> <span class=st>&quot;/tmp/zot1&quot;</span><span class=fu>,</span></span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;dedupe&quot;</span><span class=fu>:</span> <span class=kw>true</span><span class=fu>,</span></span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;gc&quot;</span><span class=fu>:</span> <span class=kw>true</span></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true tabindex=-1></a>    <span class=fu>},</span></span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true tabindex=-1></a>    <span class=dt>&quot;/b&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;rootDirectory&quot;</span><span class=fu>:</span> <span class=st>&quot;/tmp/zot2&quot;</span><span class=fu>,</span></span>
<span id=cb1-10><a href=#cb1-10 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;dedupe&quot;</span><span class=fu>:</span> <span class=kw>true</span></span>
<span id=cb1-11><a href=#cb1-11 aria-hidden=true tabindex=-1></a>    <span class=fu>},</span></span>
<span id=cb1-12><a href=#cb1-12 aria-hidden=true tabindex=-1></a>    <span class=dt>&quot;/c&quot;</span><span class=fu>:</span> <span class=fu>{</span></span>
<span id=cb1-13><a href=#cb1-13 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;rootDirectory&quot;</span><span class=fu>:</span> <span class=st>&quot;/tmp/zot3&quot;</span><span class=fu>,</span></span>
<span id=cb1-14><a href=#cb1-14 aria-hidden=true tabindex=-1></a>      <span class=dt>&quot;dedupe&quot;</span><span class=fu>:</span> <span class=kw>false</span></span>
<span id=cb1-15><a href=#cb1-15 aria-hidden=true tabindex=-1></a>    <span class=fu>}</span></span>
<span id=cb1-16><a href=#cb1-16 aria-hidden=true tabindex=-1></a>  <span class=fu>}</span></span>
<span id=cb1-17><a href=#cb1-17 aria-hidden=true tabindex=-1></a><span class=fu>}</span></span></code></pre></div></td> </tr> <tr class=even> <td style="text-align: left;"><p><code>storageDriver</code></p></td> <td style="text-align: left;"><p>(Remote storage only) Contains settings for a remote storage service. See <a href=#config-s3><i>Configuring remote storage with s3</i></a> for details.</p></td> </tr> <tr class=even> <td style="text-align: left;"><p><code>cacheDriver</code></p></td> <td style="text-align: left;"><p>Specifies which database is used to store duplicate blobs when deduplication is enabled. See <a href=#config-cache><i>Cache drivers</i></a> for details.</p></td></p></td> </tr> </tbody> </table> <p><a name=config-gc></a></p> <h3 id=configuring-garbage-collection>Configuring garbage collection<a class=headerlink href=#configuring-garbage-collection title="Permanent link">&para;</a></h3> <p>The zot configuration model allows for enabling and disabling garbage collection (<code>gc</code>) and specifying a periodic interval (<code>gcInterval</code>) for collection. </p> <table> <thead> <tr> <th><code>gc</code></th> <th><code>gcInterval</code></th> <th>Result</th> </tr> </thead> <tbody> <tr> <td>false</td> <td>n/a</td> <td>GC disabled</td> </tr> <tr> <td>omitted</td> <td>n/a</td> <td>GC enabled with 1 hour interval (default)</td> </tr> <tr> <td>true</td> <td>omitted</td> <td>GC enabled with 1 hour interval</td> </tr> <tr> <td>true</td> <td>0</td> <td>GC runs only once</td> </tr> <tr> <td>true</td> <td>&gt;0</td> <td>GC enabled with specified interval</td> </tr> </tbody> </table> <p>The configuration model also allows the configuration of a tunable delay (<code>gcDelay</code>), which can be set depending on client network speeds and the size of blobs. The <code>gcDelay</code> attribute causes collection to run once after the specified delay time. This attribute has a default value of one hour (<code>1h</code>).</p> <p><a name=config-s3></a></p> <h2 id=configuring-remote-storage-with-s3>Configuring remote storage with s3<a class=headerlink href=#configuring-remote-storage-with-s3 title="Permanent link">&para;</a></h2> <p>To configure an Amazon Simple Storage Service (s3) bucket for zot, use the <code>storageDriver</code> attribute in the zot configuration file, as shown in the following example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>        </span><span class=nt>&quot;storageDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3&quot;</span><span class=p>,</span>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=w>            </span><span class=nt>&quot;bucket&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot-storage&quot;</span><span class=p>,</span>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=w>            </span><span class=nt>&quot;secure&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>            </span><span class=nt>&quot;skipverify&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>            </span><span class=nt>&quot;accesskey&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;YOUR_ACCESS_KEY_ID&gt;&quot;</span><span class=p>,</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>            </span><span class=nt>&quot;secretkey&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;YOUR_SECRET_ACCESS_KEY&gt;&quot;</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>    </span><span class=p>}</span>
</code></pre></div> <p>The following table lists the attributes of <code>storageDriver</code> when configuring s3 for remote storage:</p> <table> <thead> <tr> <th>Attribute</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>name</td> <td>yes</td> <td>Name of storage driver. Only <code>s3</code> is supported for now.</td> </tr> <tr> <td>accesskey</td> <td>no</td> <td>Your AWS Access Key. If you use IAM roles, omit to fetch temporary credentials from IAM.</td> </tr> <tr> <td>secretkey</td> <td>no</td> <td>Your AWS Secret Key. If you use IAM roles, omit to fetch temporary credentials from IAM.</td> </tr> <tr> <td>region</td> <td>yes</td> <td>The AWS region in which your bucket exists.</td> </tr> <tr> <td>regionendpoint</td> <td>no</td> <td>Endpoint for S3 compatible storage services (Minio, etc).</td> </tr> <tr> <td>forcepathstyle</td> <td>no</td> <td>To enable path-style addressing when the value is set to true. The default is true.</td> </tr> <tr> <td>bucket</td> <td>yes</td> <td>The bucket name in which you want to store the registryâ€™s data.</td> </tr> <tr> <td>encrypt</td> <td>no</td> <td>Specifies whether the registry stores the image in encrypted format or not. A boolean value. The default is false.</td> </tr> <tr> <td>keyid</td> <td>no</td> <td>Optional KMS key ID to use for encryption (encrypt must be true, or this parameter is ignored). The default is none.</td> </tr> <tr> <td>secure</td> <td>no</td> <td>Indicates whether to use HTTPS instead of HTTP. A boolean value. The default is true.</td> </tr> <tr> <td>skipverify</td> <td>no</td> <td>Skips TLS verification when the value is set to true. The default is false.</td> </tr> <tr> <td>v4auth</td> <td>no</td> <td>Indicates whether the registry uses Version 4 of AWSâ€™s authentication. The default is true.</td> </tr> <tr> <td>chunksize</td> <td>no</td> <td>The S3 API requires multipart upload chunks to be at least 5MB. This value should be a number that is larger than 5 * 1024 * 1024.</td> </tr> <tr> <td>multipartcopychunksize</td> <td>no</td> <td>Default chunk size for all but the last S3 Multipart Upload part when copying stored objects.</td> </tr> <tr> <td>multipartcopymaxconcurrency</td> <td>no</td> <td>Max number of concurrent S3 Multipart Upload operations when copying stored objects.</td> </tr> <tr> <td>multipartcopythresholdsize</td> <td>no</td> <td>Default object size above which S3 Multipart Upload will be used when copying stored objects.</td> </tr> <tr> <td>rootdirectory</td> <td>no</td> <td>This is a prefix that is applied to all S3 keys to allow you to segment data in your bucket if necessary.</td> </tr> <tr> <td>storageclass</td> <td>no</td> <td>The S3 storage class applied to each registry file. The default is STANDARD.</td> </tr> <tr> <td>useragent</td> <td>no</td> <td>The User-Agent header value for S3 API operations.</td> </tr> <tr> <td>usedualstack</td> <td>no</td> <td>Use AWS dual-stack API endpoints.</td> </tr> <tr> <td>accelerate</td> <td>no</td> <td>Enable S3 Transfer Acceleration.</td> </tr> <tr> <td>objectacl</td> <td>no</td> <td>The S3 Canned ACL for objects. The default value is â€œprivateâ€.</td> </tr> <tr> <td>loglevel</td> <td>no</td> <td>The log level for the S3 client. The default value is off.</td> </tr> </tbody> </table> <p>For more information, see the <a href=https://distribution.github.io/distribution/storage-drivers/s3/ >s3 storage driver docs</a>.</p> <h3 id=s3-credentials>s3 Credentials<a class=headerlink href=#s3-credentials title="Permanent link">&para;</a></h3> <p>In the s3 configuration file example, the s3 credentials were configured with the attributes <code>accesskey</code> and <code>secretkey.</code> As an alternative, you can omit these attributes from the configuration file and you can configure them using environment variables or a credential file.</p> <ul> <li> <p>Environment variables</p> <p>zot looks for credentials in the following environment variables:</p> <div class=highlight><pre><span></span><code>AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
AWS_SESSION_TOKEN (optional)
</code></pre></div> </li> <li> <p>Credential file</p> <p>A credential file is a plaintext file that contains your access keys, as shown in the following example.</p> <div class=highlight><pre><span></span><code>[default]
aws_access_key_id = &lt;YOUR_DEFAULT_ACCESS_KEY_ID&gt;
aws_secret_access_key = &lt;YOUR_DEFAULT_SECRET_ACCESS_KEY&gt;

[test-account]
aws_access_key_id = &lt;YOUR_TEST_ACCESS_KEY_ID&gt;
aws_secret_access_key = &lt;YOUR_TEST_SECRET_ACCESS_KEY&gt;

[prod-account]
; work profile
aws_access_key_id = &lt;YOUR_PROD_ACCESS_KEY_ID&gt;
aws_secret_access_key = &lt;YOUR_PROD_SECRET_ACCESS_KEY&gt;
</code></pre></div> <p>The <code>[default]</code> heading defines credentials for the default profile, which zot will use unless you configure it to use another profile. You can specify a profile using the <code>AWS_PROFILE</code> environment variable as in this example:</p> <div class=highlight><pre><span></span><code>AWS_PROFILE=test-account
</code></pre></div> <p>The credential file must be named <code>credentials.</code> The file must be located in the <code>.aws/</code> subdirectory in the home directory of the same server that is running your zot application.</p> </li> </ul> <p>For more details about specifying s3 credentials, see the <a href=https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials>AWS documentation</a>.</p> <h3 id=s3-permissions-scopes>S3 permissions scopes<a class=headerlink href=#s3-permissions-scopes title="Permanent link">&para;</a></h3> <p>The following AWS policy is required by zot for push and pull. </p> <blockquote> <p><img alt=âœ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/270f.svg title=:pencil2:> Replace S3_BUCKET_NAME with the name of your s3 bucket.</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=p>[</span><span class=err>AWS</span><span class=w> </span><span class=err>CONFIGURATION</span><span class=p>]</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=p>{</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=w>        </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span>
<a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=w>        </span><span class=s2>&quot;s3:GetBucketLocation&quot;</span><span class=p>,</span>
<a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=w>        </span><span class=s2>&quot;s3:ListBucketMultipartUploads&quot;</span>
<a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=w>      </span><span class=p>],</span>
<a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::&lt;S3_BUCKET_NAME&gt;&quot;</span>
<a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=w>        </span><span class=s2>&quot;s3:PutObject&quot;</span><span class=p>,</span>
<a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>        </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>,</span>
<a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>        </span><span class=s2>&quot;s3:DeleteObject&quot;</span><span class=p>,</span>
<a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=w>        </span><span class=s2>&quot;s3:ListMultipartUploadParts&quot;</span><span class=p>,</span>
<a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>        </span><span class=s2>&quot;s3:AbortMultipartUpload&quot;</span>
<a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>      </span><span class=p>],</span>
<a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::&lt;S3_BUCKET_NAME&gt;/*&quot;</span>
<a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>  </span><span class=p>]</span>
<a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a><span class=p>}</span>
</code></pre></div> <p>For more details about configuring AWS policies, see the <a href=https://docs.aws.amazon.com/index.html>AWS documentation</a>.</p> <p><a name=config-cache></a></p> <h2 id=cache-drivers>Cache drivers<a class=headerlink href=#cache-drivers title="Permanent link">&para;</a></h2> <p>A cache driver is used to store duplicate blobs when <code>dedupe</code> is enabled. zot supports database caching using BoltDB as the cache driver for local filesystems and DynamoDB and Redis for remote filesystems.</p> <h3 id=boltdb>BoltDB<a class=headerlink href=#boltdb title="Permanent link">&para;</a></h3> <p>If you don't specify a cache driver, zot defaults to <a href=https://dbdb.io/db/boltdb>BoltDB</a>. BoltDB is stored either in zot's root directory or in the subpath root directory.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>        </span><span class=nt>&quot;dedupe&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=p>}</span>
</code></pre></div> <p>In this example, BoltDB can be found at /tmp/zot/cache.db.</p> <blockquote> <p><img alt=âš  class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg title=:warning:> Because BoltDB does not provide concurrent access for writes, multiple instances/replicas of zot are not supported with a BoltDB configuration.</p> </blockquote> <h3 id=dynamodb>DynamoDB<a class=headerlink href=#dynamodb title="Permanent link">&para;</a></h3> <p>To use <a href=https://aws.amazon.com/dynamodb/ >DynamoDB</a> as the cache driver, the following storage configuration must be present:</p> <ul> <li><code>dedupe</code> is enabled</li> <li><code>remoteCache</code> is enabled</li> <li><code>cacheDriver</code> attribute is configured as in the following example:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>        </span><span class=nt>&quot;dedupe&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>        </span><span class=nt>&quot;remoteCache&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;dynamodb&quot;</span><span class=p>,</span><span class=w>                  </span><span class=c1>// driver name</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>            </span><span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;http://localhost:4566&quot;</span><span class=p>,</span><span class=w> </span><span class=c1>// aws endpoint</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span><span class=w>               </span><span class=c1>// aws region</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>            </span><span class=nt>&quot;cacheTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotBlobTable&quot;</span><span class=w>     </span><span class=c1>// table to store deduped blobs</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=p>},</span>
</code></pre></div> <p>The AWS GO SDK loads additional configuration and credentials values from your environment variables, shared credentials, and shared configuration files.</p> <p>If the search extension is enabled, additional parameters are required:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;dynamodb&quot;</span><span class=p>,</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>            </span><span class=nt>&quot;endpoint&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;http://localhost:4566&quot;</span><span class=p>,</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>            </span><span class=nt>&quot;cacheTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotBlobTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=w>            </span><span class=c1>// used by auth</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>            </span><span class=nt>&quot;userDataTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotUserDataTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>            </span><span class=nt>&quot;apiKeyTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotApiKeyDataTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>            </span><span class=c1>// used by search extension</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>            </span><span class=nt>&quot;repoMetaTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotRepoMetadataTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=w>            </span><span class=nt>&quot;imageMetaTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotImageMetaTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=w>            </span><span class=nt>&quot;repoBlobsInfoTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotRepoBlobsInfoTable&quot;</span><span class=p>,</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=w>            </span><span class=nt>&quot;versionTablename&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ZotVersion&quot;</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=w>        </span><span class=p>}</span>
</code></pre></div> <h4 id=dynamodb-permission-scopes>DynamoDB permission scopes<a class=headerlink href=#dynamodb-permission-scopes title="Permanent link">&para;</a></h4> <p>The following AWS policy is required by zot for caching blobs. </p> <blockquote> <p><img alt=âœ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/270f.svg title=:pencil2:> Replace DYNAMODB_TABLE with the name of your table, which should be the value of <code>cacheTablename</code> in the zot configuration. </p> <p>In this case, the AWS <code>Resource</code> value would be <code>arn:aws:dynamodb:*:*:table/ZotBlobTable</code></p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=p>[</span><span class=err>AWS</span><span class=w> </span><span class=err>CONFIGURATION</span><span class=p>]</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=p>{</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>  </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>  </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=p>{</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>      </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>      </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>        </span><span class=s2>&quot;dynamodb:CreateTable&quot;</span><span class=p>,</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>        </span><span class=s2>&quot;dynamodb:DescribeTable&quot;</span><span class=p>,</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=w>        </span><span class=s2>&quot;dynamodb:DeleteTable&quot;</span><span class=p>,</span>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=w>        </span><span class=s2>&quot;dynamodb:Scan&quot;</span><span class=p>,</span>
<a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=w>        </span><span class=s2>&quot;dynamodb:BatchGetItem&quot;</span><span class=p>,</span>
<a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=w>        </span><span class=s2>&quot;dynamodb:GetItem&quot;</span><span class=p>,</span>
<a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=w>        </span><span class=s2>&quot;dynamodb:UpdateItem&quot;</span><span class=p>,</span>
<a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=w>        </span><span class=s2>&quot;dynamodb:DeleteItem&quot;</span>
<a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=w>      </span><span class=p>],</span>
<a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=w>      </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:dynamodb:*:*:table/&lt;DYNAMODB_TABLE&gt;&quot;</span>
<a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=w>  </span><span class=p>]</span>
<a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=p>}</span>
</code></pre></div> <p>Note <code>dynamodb:DeleteTable</code> is used only in running the zot tests, should not be needed in production.</p> <p>For more details about configuring AWS DynamoDB, see the <a href=https://docs.aws.amazon.com/dynamodb/ >AWS documentation</a>.</p> <h3 id=redis>Redis<a class=headerlink href=#redis title="Permanent link">&para;</a></h3> <p><a href=https://redis.io/ >Redis</a> is an alternative to BoltDB (which cannot be shared by multiple zot instances) and DynamoDB (which requires access to AWS).</p> <p>To use Redis as the cache driver, the following storage configuration must be present:</p> <ul> <li><code>remoteCache</code> is enabled</li> <li><code>cacheDriver</code> attribute is configured as in the following example:</li> </ul> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>        </span><span class=nt>&quot;remoteCache&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;redis&quot;</span><span class=p>,</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>            </span><span class=nt>&quot;url&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;redis://localhost:6379&quot;</span><span class=p>,</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=w>            </span><span class=nt>&quot;keyprefix&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot&quot;</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=w>    </span><span class=p>},</span>
</code></pre></div> <p>The cache driver name <code>redis</code> selects the Redis driver implementation.</p> <p>The key <code>keyprefix</code> is a string prepended to all Redis keys created by this zot instance. If no string is specified, the default value is <code>zot</code>. If multiple zot instances share the same Redis database and storage, <code>keyprefix</code> should be the same in all their configurations. If multiple zot instances share the same Redis database, but have different storage locations containing different images, <code>keyprefix</code> should be different in all their configurations.</p> <p>The <code>url</code> string can contain query parameters for various settings, and it can be used for both Redis single instance and cluster configurations. More details on how <code>url</code> is parsed are available at: - <a href=https://github.com/redis/go-redis/blob/v9.7.0/options.go#L247>https://github.com/redis/go-redis/blob/v9.7.0/options.go#L247</a> - <a href=https://github.com/redis/go-redis/blob/v9.7.0/osscluster.go#L144>https://github.com/redis/go-redis/blob/v9.7.0/osscluster.go#L144</a></p> <p>At this time the library we import for <code>url</code> parsing does not support Redis sentry. For this reason we also support passing the parameters individually as keys in the same <code>cacheDriver</code> map. If and only if the <code>url</code> setting is missing, the other parameters are read from <code>cacheDriver</code>. The keys are the same as the attributes that would otherwise be included in the <code>url</code>.</p> <p>In the case of a Redis Sentinel setup, you would need to add each key manually in the <code>cacheDriver</code> map and make sure to specify a <code>master_name</code> key, see <a href=https://github.com/redis/go-redis/blob/v9.7.0/universal.go#L240>https://github.com/redis/go-redis/blob/v9.7.0/universal.go#L240</a></p> <h4 id=redis-cluster-configuration>Redis cluster configuration<a class=headerlink href=#redis-cluster-configuration title="Permanent link">&para;</a></h4> <p>The following storage configuration is for a Redis cluster:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>        </span><span class=nt>&quot;remoteCache&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;redis&quot;</span><span class=p>,</span>
<a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>            </span><span class=nt>&quot;url&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;redis://user:password@host1:6379?addr=host2:6379&amp;addr=host3:6379&quot;</span><span class=p>,</span>
<a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>            </span><span class=nt>&quot;keyprefix&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot&quot;</span>
<a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=p>}</span>
</code></pre></div> <h4 id=add-redis-configuration-parameters>Add Redis configuration parameters<a class=headerlink href=#add-redis-configuration-parameters title="Permanent link">&para;</a></h4> <p>The following storage configuration contains all Redis parameters:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=w>    </span><span class=nt>&quot;storage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/tmp/zot&quot;</span><span class=p>,</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>        </span><span class=nt>&quot;remoteCache&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>        </span><span class=nt>&quot;cacheDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;redis&quot;</span><span class=p>,</span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>            </span><span class=nt>&quot;keyprefix&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot&quot;</span><span class=p>,</span>
<a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>            </span><span class=nt>&quot;addr&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;host1:6379&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host2:6379&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;host3:6379&quot;</span><span class=p>],</span>
<a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=w>            </span><span class=nt>&quot;client_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;client&quot;</span><span class=p>,</span>
<a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>            </span><span class=nt>&quot;db&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>            </span><span class=nt>&quot;protocol&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>            </span><span class=nt>&quot;username&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user1&quot;</span><span class=p>,</span>
<a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>            </span><span class=nt>&quot;password&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pass1&quot;</span><span class=p>,</span>
<a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>            </span><span class=nt>&quot;sentinel_username&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;user2&quot;</span><span class=p>,</span>
<a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>            </span><span class=nt>&quot;sentinel_password&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;pass2&quot;</span><span class=p>,</span>
<a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=w>            </span><span class=nt>&quot;max_retries&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>            </span><span class=nt>&quot;min_retry_backoff&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>            </span><span class=nt>&quot;max_retry_backoff&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=w>            </span><span class=nt>&quot;dial_timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=w>            </span><span class=nt>&quot;read_timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=w>            </span><span class=nt>&quot;write_timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=w>            </span><span class=nt>&quot;context_timeout_enabled&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=w>            </span><span class=nt>&quot;pool_fifo&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=w>            </span><span class=nt>&quot;pool_size&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a><span class=w>            </span><span class=nt>&quot;pool_timeout&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=w>            </span><span class=nt>&quot;min_idle_conns&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=w>            </span><span class=nt>&quot;max_idle_conns&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=w>            </span><span class=nt>&quot;max_active_conns&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=w>            </span><span class=nt>&quot;conn_max_idle_time&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a><span class=w>            </span><span class=nt>&quot;conn_max_lifetime&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;5s&quot;</span><span class=p>,</span>
<a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a><span class=w>            </span><span class=nt>&quot;max_redirects&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a><span class=w>            </span><span class=nt>&quot;read_only&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a><span class=w>            </span><span class=nt>&quot;route_by_latency&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a><span class=w>            </span><span class=nt>&quot;route_randomly&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-34 name=__codelineno-10-34 href=#__codelineno-10-34></a><span class=w>            </span><span class=nt>&quot;master_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zotmeta&quot;</span><span class=p>,</span>
<a id=__codelineno-10-35 name=__codelineno-10-35 href=#__codelineno-10-35></a><span class=w>            </span><span class=nt>&quot;disable_identity&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<a id=__codelineno-10-36 name=__codelineno-10-36 href=#__codelineno-10-36></a><span class=w>            </span><span class=nt>&quot;identity_suffix&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zotmeta&quot;</span><span class=p>,</span>
<a id=__codelineno-10-37 name=__codelineno-10-37 href=#__codelineno-10-37></a><span class=w>            </span><span class=nt>&quot;unstable_resp3&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-10-38 name=__codelineno-10-38 href=#__codelineno-10-38></a><span class=w>        </span><span class=p>},</span>
<a id=__codelineno-10-39 name=__codelineno-10-39 href=#__codelineno-10-39></a><span class=w>    </span><span class=p>}</span>
</code></pre></div> <blockquote> <p><img alt=âš  class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/26a0.svg title=:warning:> setting all of the parameters above for the same use case does not make sense, as some parameters for single instance, cluster and sentry configurations exclude one another.</p> </blockquote> <h2 id=remote-storage-subpaths>Remote storage subpaths<a class=headerlink href=#remote-storage-subpaths title="Permanent link">&para;</a></h2> <p>As in the case with local filesystem storage, you can use multiple remote storage locations using the <code>subpath</code> attribute, as in the following example.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nt>&quot;subPaths&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=w>    </span><span class=nt>&quot;/a&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>        </span><span class=nt>&quot;rootDirectory&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;/zot-a&quot;</span><span class=p>,</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>        </span><span class=nt>&quot;storageDriver&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>            </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;s3&quot;</span><span class=p>,</span>
<a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>            </span><span class=nt>&quot;region&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;us-east-2&quot;</span><span class=p>,</span>
<a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=w>            </span><span class=nt>&quot;bucket&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;zot-storage&quot;</span><span class=p>,</span>
<a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=w>            </span><span class=nt>&quot;secure&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span>
<a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=w>            </span><span class=nt>&quot;skipverify&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span>
<a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=w>        </span><span class=p>}</span>
<a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=w>    </span><span class=p>},</span>
<a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=w>    </span><span class=nt>&quot;/b&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=w>       </span><span class=err>.</span>
<a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=w>       </span><span class=err>.</span>
<a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=w>       </span><span class=err>.</span>
<a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=w>    </span><span class=p>}</span>
<a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=p>}</span>
</code></pre></div> <p>The <code>subPaths</code> feature ties together several separate storage filesystems and backends behind the same HTTP API interface. In the example above, both repository paths "/a" and "/b" are exposed to clients. Content on these two paths can be hosted completely separately by different storage services, locations, or filesystems, with no difference to the user interface and no perceptible difference to the user experience. This is useful if one wants to serve existing OCI images from different backends or if storage can be expanded only by using different backing stores.</p> <blockquote> <p><img alt=ðŸ’¡ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f4a1.svg title=:bulb:> zot also supports different storage drivers for each subpath.</p> </blockquote> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 23, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2019 - 2025 The zot project authors, All Rights Reserved. | The Linux FoundationÂ® (TLF) has registered trademarks and uses trademarks. For a list of TLF trademarks, see <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> </div> </div> <div class=md-social> <a href=https://github.com/project-zot/zot.git target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/zothub target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://cloud-native.slack.com/archives/C03EGRE4QGH target=_blank rel=noopener title=cloud-native.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "search.suggest", "search.highlight", "search.share", "toc.follow", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.471ce7a9.min.js></script> </body> </html>